!function(e){"use strict";var a=!!("object"==typeof jnews&&"object"==typeof jnews.library)&&jnews.library,t=function(t,n){if(a){var o=this;o.element=e(t),o.options=n,o.xhr=null,o.xhr_cache=[],o.lock_action=!1,o.unique=o.element.data("unique"),o.data={filter:0,filter_type:"all",current_page:1,attribute:window[o.unique]||{}},o.ajax_mode=o.data.attribute.pagination_mode,o.header=o.element.find(".jeg_block_heading"),o.container=o.element.find(".jeg_block_container"),o.nav_block=o.element.find(".jeg_block_navigation"),o.ad_code=o.element.find(".jeg_ad_code").val(),o.nav_next=null,o.nav_prev=null,o.module_overlay=o.container.find(".module-overlay"),o.load_more_block=o.nav_block.find(".jeg_block_loadmore"),"nextprev"===o.ajax_mode&&(o.nav_next=o.nav_block.find(".next"),o.nav_prev=o.nav_block.find(".prev"),o.nav_next.on("click",o.click_next.bind(o)),o.nav_prev.on("click",o.click_prev.bind(o))),"loadmore"!==o.ajax_mode&&"scrollload"!==o.ajax_mode||(o.nav_next=o.load_more_block.find("a"),o.nav_next.on("click",o.load_more.bind(o))),"scrollload"===o.ajax_mode&&(o.load_limit=o.data.attribute.pagination_scroll_limit,o.load_scroll()),o.masonry_init(),o.init(),o.element.trigger("jnews_module_init",[o])}};t.DEFAULTS={},t.prototype.init=function(){var e=this;e.subcat=e.header.find(".jeg_subcat"),e.subcat.length&&e.subcat.okayNav({swipe_enabled:!1,threshold:80,toggle_icon_content:"<span></span><span></span><span></span>"}),e.assign_header()},t.prototype.load_scroll=function(){var e=this;e.nav_next.hasClass("disabled")||(e.load_limit>e.data.current_page||0==e.load_limit)&&e.nav_next.waypoint((function(){e.data.current_page=e.data.current_page+1,e.request_ajax("scroll"),this.destroy()}),{offset:"100%",context:window})},t.prototype.click_next=function(a){var t=this,n=t.nav_next;a.preventDefault(),e(n).hasClass("disabled")||t.lock_action||(t.data.current_page=t.data.current_page+1,t.request_ajax("next"))},t.prototype.click_prev=function(a){var t=this,n=t.nav_prev;a.preventDefault(),e(n).hasClass("disabled")||t.lock_action||(t.data.current_page=t.data.current_page-1,t.request_ajax("prev"))},t.prototype.load_more=function(a){var t=this,n=t.nav_next;a.preventDefault(),e(n).hasClass("disabled")||t.lock_action||(t.data.current_page=t.data.current_page+1,t.request_ajax("more"))},t.prototype.assign_header=function(){var a=this;e(a.header).on("click",".subclass-filter",e.proxy(a.subclass_click,a))},t.prototype.subclass_click=function(a){var t=this,n=a.target;a.preventDefault(),t.lock_action||(this.header.find(".subclass-filter").removeClass("current"),e(n).addClass("current"),t.data.filter=e(n).data("id"),t.data.filter_type=e(n).data("type"),t.data.current_page=1,t.request_ajax("subclass"))},t.prototype.request_ajax=function(a){var t=this;t.lock_action=!0;var n={action:jnewsoption.module_prefix+t.data.attribute.class,module:!0,data:t.data},o=t.cache_get(n);o?(t.before_ajax_request(a,!1),setTimeout((function(){t.load_ajax(a,n,o),t.element.trigger("jnews_module_ajax")}),100)):(t.before_ajax_request(a,!0),t.xhr=e.ajax({url:jnews_ajax_url,type:"post",dataType:"json",data:n,success:function(e){t.load_ajax(a,n,e),t.cache_save(n,e),t.element.trigger("jnews_module_ajax")}}))},t.prototype.cache_get=function(e){for(var a=this,t=JSON.stringify(e),n=0;n<a.xhr_cache.length;n++)if(a.xhr_cache[n].param==t)return a.cache_prepare(a.xhr_cache[n].result);return!1},t.prototype.cache_prepare=function(a){a.content="<div>"+a.content+"</div>";var t=e(a.content);return t.find("img").each((function(){var a=e(this).data("src");e(this).attr("src",a).removeClass("lazyload").addClass("lazyloaded")})),a.content=t.html(),a},t.prototype.cache_save=function(e,a){var t=JSON.stringify(e);this.xhr_cache.push({param:t,result:a})},t.prototype.load_ajax=function(e,a,t){var n=this;switch(n.lock_action=!1,n.ajax_mode){case"loadmore":n.load_ajax_load_more(t,e);break;case"scrollload":n.load_scroll_more(t,e);break;default:n.load_ajax_next_prev(t,e)}jnews.like&&jnews.like.init(),jnews.share&&jnews.share.init()},t.prototype.before_ajax_request=function(e,a){var t=this;t.element.removeClass("loaded next prev more scroll subclass").addClass("loading"),"next"!==e&&"prev"!==e&&"subclass"!==e||!a||t.module_overlay.show(),"more"!==e&&"scroll"!==e||t.load_more_block.find("a").text(t.load_more_block.find("a").data("loading")).addClass("active")},t.prototype.after_ajax_request=function(e){var a=this;a.element.removeClass("loading").addClass("loaded").addClass(e),"next"!==e&&"prev"!==e&&"subclass"!==e||a.module_overlay.hide(),"more"!==e&&"scroll"!==e||(a.load_more_block.find("a").text(a.load_more_block.find("a").data("load")).removeClass("active"),void 0!==a.load_more_block.find("a").data("icon")&&a.load_more_block.find("a").html(a.load_more_block.find("a").html()+' <i class="fa '+a.load_more_block.find("a").data("icon")+'"></i>'))},t.prototype.replace_content=function(a){this.container.children().each((function(){e(this).hasClass("module-overlay")||e(this).remove()})),this.container.prepend(a)},t.prototype.load_ajax_next_prev=function(a,t){var n=this,o=e(a.content);o.find(".jeg_ad_module").length&&n.ad_code&&o.find(".ads-wrapper").html(n.ad_code),n.replace_content(o),null!==n.nav_next&&(a.next?n.nav_next.removeClass("disabled"):n.nav_next.addClass("disabled")),null!==n.nav_prev&&(a.prev?n.nav_prev.removeClass("disabled"):n.nav_prev.addClass("disabled")),a.next||a.prev?null!==n.nav_prev&&n.nav_next.parent().removeClass("inactive"):null!==n.nav_next&&n.nav_next.parent().addClass("inactive"),n.after_ajax_request(t),n.masonry_init(),e(window).trigger("resize")},t.prototype.load_ajax_load_more=function(a,t){var n=this,o=e(a.content),r=0;o.each((function(){(e(this).hasClass("jeg_ad_module")&&n.ad_code&&e(this).find(".ads-wrapper").html(n.ad_code),e(this).hasClass("jeg_post"))?e(this).addClass("jeg_ajax_loaded anim_"+r):e(this).find(".jeg_post").each((function(){e(this).addClass("jeg_ajax_loaded anim_"+r),r++}));r++})),n.container.find(".jeg_post").removeClass("jeg_ajax_loaded"),n.container.find(".jeg_ad_module").removeClass("jeg_ajax_loaded"),1==n.data.current_page?n.replace_content(o):n.element.find(".jeg_load_more_flag").append(o),a.next?n.nav_next.removeClass("disabled"):n.nav_next.addClass("disabled"),n.after_ajax_request(t),n.masonry_load_more(o),e(window).trigger("resize")},t.prototype.load_scroll_more=function(a,t){var n=this,o=e(a.content),r=0;o.each((function(){(e(this).hasClass("jeg_ad_module")&&n.ad_code&&e(this).find(".ads-wrapper").html(n.ad_code),e(this).hasClass("jeg_post"))?e(this).addClass("jeg_ajax_loaded anim_"+r):e(this).find(".jeg_post").each((function(){e(this).addClass("jeg_ajax_loaded anim_"+r),r++}));r++})),n.container.find(".jeg_post").removeClass("jeg_ajax_loaded"),n.container.find(".jeg_ad_module").removeClass("jeg_ajax_loaded"),1==n.data.current_page?n.container.html("").html(o):n.element.find(".jeg_load_more_flag").append(o),a.next?n.nav_next.removeClass("disabled"):n.nav_next.addClass("disabled"),n.after_ajax_request(t),n.masonry_load_more(o),e(window).trigger("resize"),setTimeout((function(){n.load_scroll()}),500)},t.prototype.masonry_load_more=function(e){var a=this;a.container.find(".jeg_posts_masonry").length&&setTimeout((function(){a.masonry.isotope("appended",e)}),150)},t.prototype.masonry_init=function(){var a=this;a.container.find(".jeg_posts_masonry").length&&(setTimeout((function(){a.masonry=a.container.find(".jeg_posts_masonry .jeg_posts").isotope({itemSelector:".jeg_post",layoutMode:"masonry"}),a.masonry.imagesLoaded().progress((function(){a.masonry.isotope("layout")}))}),150),e(window).on("resize",(function(){setTimeout((function(){a.masonry.isotope("layout")}),1e3)})))};var n=e.fn.jmodule;e.fn.jmodule=function(a){return e(this).each((function(){var n=e(this),o=e.extend({},t.DEFAULTS,n.data(),"object"==typeof a&&a),r=n.data("jeg.module");r||n.data("jeg.module",r=new t(this,o))}))},e.fn.jmodule.Constructor=t,e.fn.jmodule.noConflict=function(){return e.fn.jmodule=n,this},e((function(){e(".jeg_module_hook").jmodule()}))}(jQuery);